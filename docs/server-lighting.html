<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Lighting · Bestia Developer Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Gruppen Renderlayer&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Lighting · Bestia Developer Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.bestia-game.net/index.html"/><meta property="og:description" content="&lt;p&gt;Gruppen Renderlayer&lt;/p&gt;
"/><meta property="og:image" content="https://docs.bestia-game.net/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.bestia-game.net/img/docusaurus.png"/><link rel="shortcut icon" href="/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs2015.min.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-white-100.png" alt="Bestia Developer Documentation"/><h2 class="headerTitleWithLogo">Bestia Developer Documentation</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/about-manifest.html" target="_self">Docs</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Server</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/about-bestia.html">About</a></li><li class="navListItem"><a class="navItem" href="/docs/about-manifest.html">The Manifest</a></li><li class="navListItem"><a class="navItem" href="/docs/about-mechanics.html">Game Mechanics</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Mechanics</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/mech-statusvalues.html">Status Values</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-skills.html">Skills</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-resources.html">Resources</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-time.html">Bestia Time</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-cults.html">Cults</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-quests.html">Questes</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-trading.html">Trading</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-honor.html">Honor</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-exploration.html">Exploration</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-items.html">Items</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-inventory.html">Inventory</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-weather.html">Weather System</a></li><li class="navListItem"><a class="navItem" href="/docs/mech-spells.html">Spells and Attacks</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Server</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/server-architecture.html">Server Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/server-worldcreation.html">World Generation</a></li><li class="navListItem"><a class="navItem" href="/docs/server-npc-ai.html">Artificial Intelligence</a></li><li class="navListItem"><a class="navItem" href="/docs/server-scripts.html">Server Scripts</a></li><li class="navListItem"><a class="navItem" href="/docs/server-battlesystem.html">Battlesystem</a></li><li class="navListItem"><a class="navItem" href="/docs/server-streaming.html">Server Streaming</a></li><li class="navListItem"><a class="navItem" href="/docs/server-routing.html">NPC Routing</a></li><li class="navListItem"><a class="navItem" href="/docs/server-queststories.html">Stories and Quests</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/server-lighting.html">Lighting</a></li><li class="navListItem"><a class="navItem" href="/docs/server-environment.html">Environment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Client</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/client-architecture.html">Client Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/client-animation.html">Animations and Effects</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/api.html">Bestia API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Improvement Proposals</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/bip-about.html">Bestia Improvement Proposals (BIP)</a></li><li class="navListItem"><a class="navItem" href="/docs/bip-1.html">BIP 1 - ClientVars</a></li><li class="navListItem"><a class="navItem" href="/docs/bip-2.html">BIP 2 - Latency estimation</a></li><li class="navListItem"><a class="navItem" href="/docs/bip-3.html">BIP 3 - Debug mode</a></li><li class="navListItem"><a class="navItem" href="/docs/bip-4.html">BIP 4 - Dynamic Client UI</a></li><li class="navListItem"><a class="navItem" href="/docs/bip-5.html">BIP 5 - Translation Microservice</a></li><li class="navListItem"><a class="navItem" href="/docs/bip-6.html">BIP 6 - Conditional Component Sync</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Contributing</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/contrib-design.html">Artwork and Design</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Appendix</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/misc-literature.html">Literature</a></li><li class="navListItem"><a class="navItem" href="/docs/misc-resources.html">Resources</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/tfelix/bestia-docs/edit/master/docs/server-lighting.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Lighting</h1></header><article><div><span><p>Gruppen Renderlayer</p>
<p>ground
objects
sprites
effects
overlay
gui</p>
<p>Gruppenmanager? Der entsprechende Render-Layer definiert und verwaltet?
Lichtsystem
Lichtinformation wird auf dem Server benötigt Tile basiert.
Licht information wird auf dem Client benötigt, Tile basiert</p>
<p>Licht wird global in groben Chunks abgelegt.
Darüber hinaus werden Entities im System gespeichert welche Licht emmitieren.
Aus beiden wird eine Lightmap berechnet die in einer effizienten Codierung die Light Map in einem Dateiformat ablegen und an den Client senden
Der Client regeneriert diese Lightmap und rendert daraus eine Textur, die dann mit der Karte überlagert wird.</p>
<p>Es gibt eine Lightmap die mit einem Multiply über die restlichen Layer gelegt wird. Diese Lightmap wird in der Regel mit jedem neuen Update neu gezeichnet → dynamische Lichteffekte (flackern), Attacken.</p>
<p>Wie wird die Umgebung aufgehellt? Add-Layer? Der eine gewisse Grundhelligkeit erzeugt (von Lichtquellen gesteuert). Das Wettersystem z.B. kann diesen Layer beeinflussen. Tag und Nacht auch. Manche Maps besitzen auch einen statischen Helligkeitswert (Dungeons und Höhlen zum Beispiel).</p>
<p>Damit ein Objekt zur Lichtberechnung beiträgt muss es mit dem Licht-Trait ausgestattet sein. Dieser enthält und liefert folgende Informationen:</p>
<p>Lichtfarbe
Lichthelligkeit
Falloff → Normalerweise 1/r² (faked)</p>
<p>Das System muss dem Licht Trait die Tickzeit (abklingender Lichteffekt etc.) beim Abfragen der Informationen zur Verfügung stellen.</p>
<p>Blend Modes
PIXI.blendModes = { NORMAL:0, ADD:1, MULTIPLY:2, SCREEN:3, OVERLAY:4, DARKEN:5, LIGHTEN:6, COLOR_DODGE:7, COLOR_BURN:8, HARD_LIGHT:9, SOFT_LIGHT:10, DIFFERENCE:11, EXCLUSION:12, HUE:13, SATURATION:14, COLOR:15, LUMINOSITY:16 };
ggf. Color Dodge oder Add</p>
<p>zum Aufhellen der Umgebung ggf. einen der beiden Layer mit gewissem Alpha addieren.</p>
<p>Die Helligkeit und der Falloff bestimmen die Reichweite. Dieser Layer wird multipliziert mit den darunterliegenden Layern.</p>
<p>Ggf wird ein weiterer Layer für die Farbinformation benötigt um ein schönes Blending zu erziehlen.</p>
<p>Lichtsystem implementieren
Admin Chat Commands die das Licht setzen können
Dynamisches System das das globale Licht auf der Welt steuert, abhängig von der Tageszeit
Tageszeit Klasse die, abhängig von der Serverzeit, den Tag in 0 - 1 float abbildet, auch das Jahr sollte auch 0 bis 1 gemappt werden. Aktuelle Jahreszeiten sind per Enum zu liefern. (Spring, Summer, Autumn, Winter)
Lokale Lichtquellen vorsehen. Entities mit einer Component. Diese sollten so eine Ausdehnung (Bounding Box) besitzen, dass ihre Lichtreichweite abgedeckt wird.
Das System berechnet bei Änderung die Lichter neu und sendet sie an die Clients.
Übliche Periode für Lichtberechnung: Minuten.
LightEntityFactory implementieren</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/server-queststories.html"><span class="arrow-prev">← </span><span>Stories and Quests</span></a><a class="docs-next button" href="/docs/server-environment.html"><span>Environment</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo-white-100.png" alt="Bestia Developer Documentation" width="50" height="50"/></a><div><h5>Docs</h5><a href="/docs/about-bestia.html"><i class="fas fa-code"></i> Introduction</a><a href="/docs/server-architecture.html"><i class="fas fa-code"></i> Server Documentation</a><a href="/docs/client-architecture.html"><i class="fas fa-code"></i> Client Documentation</a></div><div><h5>Community</h5><a href="https://discord.gg/zZW8M2S"><i class="fab fa-discord"></i> Discord</a><a href="https://twitter.com/bestiagame" target="_blank" rel="noreferrer noopener"><i class="fab fa-twitter"></i> Twitter</a></div><div><h5>More</h5><a href="https://github.com/tfelix/bestia-docs"><i class="fab fa-github"></i> GitHub</a></div></section><section class="copyright">Copyright © 2016 -2019 Thomas Felix</section></footer></div></body></html>